// tslint:disable-next-line:max-line-length
export const worker = `!function(){"use strict";function r(r){if(Array.isArray(r)){for(var e=0,t=Array(r.length);e<r.length;e++)t[e]=r[e];return t}return Array.from(r)}var e=function(r){var e=[];return r.forEach(function(t,n){for(var a=Math.min(r.length-n,10),o=1;o<a;o+=1)!function(a){var o=r[n+a]-t;e.some(function(r){return r.interval===o&&(r.peaks.push(t),!0)})||e.push({peaks:[t],interval:o})}(o)}),e},t=function(r,e,t){for(var n=[],a=r.length,o=0;o<a;o+=1)r[o]>e&&(n.push(o),o+=t/4-1);return n},n=function(e,t){var n=[];return e.forEach(function(e){for(var a=60/(e.interval/t);a<90;)a*=2;for(;a>180;)a/=2;n.some(function(t){return t.tempo===a&&(t.peaks=[].concat(r(t.peaks),r(e.peaks)),!0)})||n.push({peaks:e.peaks,tempo:a})}),n},a=function(r,a){for(var o=[],s=.9;o.length<30&&s>=.3;)o=t(r,s,a),s-=.05;var u=e(o),f=n(u,a);return f.sort(function(r,e){return e.peaks.length-r.peaks.length}),f},o=function(r,e){return a(r,e)[0].tempo},s=function(r,e){var t=a(r,e)[0],n=t.peaks,o=t.tempo,s=Math.round(o),u=60/s;n.sort(function(r,e){return r-e});for(var f=n[0]/e;f>u;)f-=u;return{bpm:s,offset:f}};addEventListener("message",function(r){var e=r.data;try{if("analyze"===e.method){var t=e.id,n=e.params,a=n.channelData,u=n.sampleRate,f=o(a,u);postMessage({error:null,id:t,result:{tempo:f}})}else{if("guess"!==e.method)throw new Error('The given method "'+e.method+'" is not supported');var i=e.id,p=e.params,c=p.channelData,l=p.sampleRate,h=s(c,l),m=h.bpm,v=h.offset;postMessage({error:null,id:i,result:{bpm:m,offset:v}})}}catch(r){postMessage({error:{message:r.message},id:e.id,result:null})}})}();`;
