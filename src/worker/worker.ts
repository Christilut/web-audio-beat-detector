// tslint:disable-next-line:max-line-length
export const worker = `!function(){"use strict";var e=function(e){var t=[];return e.forEach(function(r,n){for(var o=Math.min(e.length-n,10),a=1;a<o;a+=1)!function(o){var a=e[n+o]-r;t.some(function(e){return e.interval===a&&(e.peaks.push(r),!0)})||t.push({interval:a,peaks:[r]})}(a)}),t},t=function(e,t,r){for(var n=[],o=e.length,a=0;a<o;a+=1)e[a]>t&&(n.push(a),a+=r/4-1);return n},r=(function(){function e(e){this.value=e}function t(t){function r(o,a){try{var u=t[o](a),s=u.value;s instanceof e?Promise.resolve(s.value).then(function(e){r("next",e)},function(e){r("throw",e)}):n(u.done?"return":"normal",u.value)}catch(e){n("throw",e)}}function n(e,t){switch(e){case"return":o.resolve({value:t,done:!0});break;case"throw":o.reject(t);break;default:o.resolve({value:t,done:!1})}(o=o.next)?r(o.key,o.arg):a=null}var o,a;this._invoke=function(e,t){return new Promise(function(n,u){var s={key:e,arg:t,resolve:n,reject:u,next:null};a?a=a.next=s:(o=a=s,r(e,t))})},"function"!=typeof t.return&&(this.return=void 0)}"function"==typeof Symbol&&Symbol.asyncIterator&&(t.prototype[Symbol.asyncIterator]=function(){return this}),t.prototype.next=function(e){return this._invoke("next",e)},t.prototype.throw=function(e){return this._invoke("throw",e)},t.prototype.return=function(e){return this._invoke("return",e)}}(),function(e){if(Array.isArray(e)){for(var t=0,r=Array(e.length);t<e.length;t++)r[t]=e[t];return r}return Array.from(e)}),n=function(e,t){var n=[];return e.forEach(function(e){for(var o=60/(e.interval/t);o<90;)o*=2;for(;o>180;)o/=2;n.some(function(t){return t.tempo===o&&(t.peaks=[].concat(r(t.peaks),r(e.peaks)),!0)})||n.push({peaks:e.peaks,tempo:o})}),n},o=function(r,o){for(var a=[],u=.9;a.length<30&&u>=.3;)a=t(r,u,o),u-=.05;var s=e(a),i=n(s,o);return i.sort(function(e,t){return t.peaks.length-e.peaks.length}),i},a=function(e,t){return o(e,t)[0].tempo},u=function(e,t){var r=o(e,t)[0],n=r.peaks,a=r.tempo,u=Math.round(a),s=60/u;n.sort(function(e,t){return e-t});for(var i=n[0]/t;i>s;)i-=s;return{bpm:u,offset:i}};addEventListener("message",function(e){var t=e.data;try{if("analyze"===t.method){var r=t.id,n=t.params,o=n.channelData,s=n.sampleRate,i=a(o,s);postMessage({error:null,id:r,result:{tempo:i}})}else{if("guess"!==t.method)throw new Error('The given method "'+t.method+'" is not supported');var f=t.id,c=t.params,l=c.channelData,p=c.sampleRate,h=u(l,p),v=h.bpm,m=h.offset;postMessage({error:null,id:f,result:{bpm:v,offset:m}})}}catch(e){postMessage({error:{message:e.message},id:t.id,result:null})}})}();`;
